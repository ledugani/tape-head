# Test info

- Name: Authentication >> should handle logout correctly
- Location: /Users/thomasdugan/workspace/tape-head/frontend/tests/auth.spec.ts:28:7

# Error details

```
Error: Timed out 5000ms waiting for expect(locator).toHaveURL(expected)

Locator: locator(':root')
Expected pattern: /\/login(\?.*)?$/
Received string:  "http://localhost:3000/dashboard"
Call log:
  - expect.toHaveURL with timeout 5000ms
  - waiting for locator(':root')
    9 × locator resolved to <html lang="en">…</html>
      - unexpected value "http://localhost:3000/dashboard"

    at /Users/thomasdugan/workspace/tape-head/frontend/tests/auth.spec.ts:82:24
```

# Page snapshot

```yaml
- alert
```

# Test source

```ts
   1 | import { test, expect } from '@playwright/test';
   2 |
   3 | test.describe('Authentication', () => {
   4 |   test.beforeEach(async ({ page }) => {
   5 |     // Clear any existing cookies before each test
   6 |     await page.context().clearCookies();
   7 |   });
   8 |
   9 |   test('should handle login correctly', async ({ page }) => {
   10 |     await page.goto('/login');
   11 |     
   12 |     // Fill in the login form
   13 |     await page.fill('input[name="email"]', 'iamtest@test.com');
   14 |     await page.fill('input[name="password"]', 'password123');
   15 |     
   16 |     // Click the login button
   17 |     await page.click('button[type="submit"]');
   18 |     
   19 |     // Should be redirected to dashboard
   20 |     await expect(page).toHaveURL('/dashboard');
   21 |     
   22 |     // Verify auth cookie was set
   23 |     const cookies = await page.context().cookies();
   24 |     const authCookie = cookies.find(cookie => cookie.name === 'auth-token');
   25 |     expect(authCookie).toBeTruthy();
   26 |   });
   27 |
   28 |   test('should handle logout correctly', async ({ page }) => {
   29 |     console.log('Starting logout test...');
   30 |     
   31 |     // Log in first
   32 |     await page.goto('/login');
   33 |     console.log('Navigated to login page');
   34 |     
   35 |     await page.fill('input[name="email"]', 'iamtest@test.com');
   36 |     await page.fill('input[name="password"]', 'password123');
   37 |     await page.click('button[type="submit"]');
   38 |     console.log('Submitted login form');
   39 |     
   40 |     await page.waitForURL('/dashboard');
   41 |     console.log('Navigated to dashboard');
   42 |     
   43 |     // Verify we're logged in
   44 |     const cookiesBefore = await page.context().cookies();
   45 |     const authCookieBefore = cookiesBefore.find(cookie => cookie.name === 'auth-token');
   46 |     expect(authCookieBefore).toBeTruthy();
   47 |     console.log('Verified auth cookie exists');
   48 |     
   49 |     // Wait for the page to be fully loaded
   50 |     await page.waitForLoadState('networkidle');
   51 |     console.log('Page loaded');
   52 |     
   53 |     // Log the page content for debugging
   54 |     const content = await page.content();
   55 |     console.log('Page content:', content);
   56 |     
   57 |     // Wait for the logout button to be visible and enabled
   58 |     console.log('Waiting for logout button...');
   59 |     const logoutButton = await page.waitForSelector('button[data-testid="logout-button"]', { 
   60 |       state: 'visible',
   61 |       timeout: 10000 
   62 |     });
   63 |     console.log('Found logout button');
   64 |     
   65 |     // Wait for the button to be enabled
   66 |     await logoutButton.waitForElementState('enabled');
   67 |     console.log('Logout button is enabled');
   68 |     
   69 |     // Add a delay before clicking
   70 |     await page.waitForTimeout(1000);
   71 |     
   72 |     // Try clicking the button using evaluate
   73 |     await page.evaluate(() => {
   74 |       const button = document.querySelector('button[data-testid="logout-button"]');
   75 |       if (button) {
   76 |         (button as HTMLButtonElement).click();
   77 |       }
   78 |     });
   79 |     console.log('Clicked logout button');
   80 |     
   81 |     // Should be redirected to login
>  82 |     await expect(page).toHaveURL(/\/login(\?.*)?$/);
      |                        ^ Error: Timed out 5000ms waiting for expect(locator).toHaveURL(expected)
   83 |     console.log('Redirected to login page');
   84 |     
   85 |     // Verify all auth cookies were cleared
   86 |     const cookiesAfter = await page.context().cookies();
   87 |     const authCookieAfter = cookiesAfter.find(cookie => cookie.name === 'auth-token');
   88 |     expect(authCookieAfter).toBeFalsy();
   89 |     console.log('Verified auth cookie was cleared');
   90 |   });
   91 |
   92 |   test('should redirect to login when accessing protected route without auth', async ({ page }) => {
   93 |     await page.goto('/dashboard');
   94 |     await expect(page).toHaveURL(/\/login(\?.*)?$/);
   95 |   });
   96 |
   97 |   test('should redirect to dashboard when accessing login with valid auth', async ({ page }) => {
   98 |     // First log in
   99 |     await page.goto('/login');
  100 |     await page.fill('input[name="email"]', 'iamtest@test.com');
  101 |     await page.fill('input[name="password"]', 'password123');
  102 |     await page.click('button[type="submit"]');
  103 |     await page.waitForURL('/dashboard');
  104 |     
  105 |     // Then try to access login page again
  106 |     await page.goto('/login');
  107 |     await expect(page).toHaveURL('/dashboard');
  108 |   });
  109 | }); 
```